# 初识Kafka

[TOC]

# 什么是Kafka
Kafka 一个多分区、多副本且基于 ZooKeeper 协调的分布式消息系统.目前 Kafka 已经定位为一个分布式流式处理平台，它有以下几个特点
- 高吞吐
- 可持久化
- 可水平扩展
- 支持流数据处理

# 基本概念
一个基本的Kafka集群由若干个**Producer**,若干个**Broker**, 若干个**Consumer**，以及一个**Zookeeper**集群构成.

![Kafka体系架构图](http://processon.com/chart_image/5d120fd0e4b039f39f45ca0d.png)

## 重要基础术语

1.**Producer** : 生产者。负责消息的发送，并将其投递到 Broker 集群中。

2.**Consumer** : 消费者。负责从 Broker 接收 并消费消息。

3.**Broker** : 服务代理节点。通常情况下我们可以将一台只部署了一个 Kafka 实例的服务器认为是一个 Broker。一个或多个 Broker 组成了一个 Kafka 集群。


## 消息主题分区

在提消息主题分区，我们先介绍一下几个比较重要的概念 **Topic**, 以及 **Partition** , **Offset**。

- **Topic** : 主题。Kafka 中的消息以主题为单位进行归类，生产者负责将消息发送到特定的主题。

- **Partition** : 分区。为了实现扩展性，一个非常大的 Topic 可以分成多个 Partition 分布到多个 Broker 上。同一主题下不同的分区的消息是不同的。

- **Offset** : 偏移量。每次消息追加到分区日志文件时，会产生一个偏移量，它可以保证分区中的消息的有序性，但是无法保证整个Topic的消息有序性，即分区有序，而非主题有序。

如果所有消息都投递到一个主题上(主题在不分区的情况)，所有该主题下的消息都将投递到一台服务器上，而单机将会很容易达到一个系统的瓶颈.

为了解决此问题，通常情况下我们会对一个主题进行分区在通过指定的参数来设置分区的个数，从而达到水平扩展的目的。

![主题分区](http://processon.com/chart_image/5d121822e4b039f39f45d33c.png)

如上图所示，主题中有3个分区，消息被顺序追加到每个分区日志文件的尾部。

Kafka 中一个主题可拆分成多个分布在不同的Broker上，不同分区提供的数据也是不同的，通过分区这种方法，可解决单机性能问题。

每一条消息被发送到 broker 之前，会根据分区规则选择存储到哪个具体的分区。

如果分区规则设定得合理，所有的消息都可以均匀地分配到不同的分区中。
